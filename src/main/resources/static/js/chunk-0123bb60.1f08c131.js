(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0123bb60"],{"76fe":function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"b",function(){return o}),a.d(t,"c",function(){return s});var r=a("b775");function n(e){return Object(r["b"])({url:"/job",method:"post",data:e})}function o(e){return Object(r["b"])({url:"/job/search",method:"post",data:e})}function s(e){return Object(r["b"])({url:"/job-record/search",method:"post",data:e})}},a316:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"table-page-search-wrapper"},[a("a-form",{attrs:{layout:"inline"}},[a("a-row",{attrs:{gutter:48}},[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"蜘蛛名"}},[a("a-input",{attrs:{placeholder:""},model:{value:e.searchModel.name,callback:function(t){e.$set(e.searchModel,"name",t)},expression:"searchModel.name"}})],1)],1),e.advanced?[a("a-col",{attrs:{md:8,sm:24}},[a("a-form-item",{attrs:{label:"表名"}},[a("a-input",{attrs:{placeholder:""},model:{value:e.searchModel.tableName,callback:function(t){e.$set(e.searchModel,"tableName",t)},expression:"searchModel.tableName"}})],1)],1)]:e._e(),a("a-col",{attrs:{md:e.advanced?24:8,sm:24}},[a("span",{staticClass:"table-page-search-submitButtons",style:e.advanced&&{float:"right",overflow:"hidden"}||{}},[a("a-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),a("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(){return e.searchModel={}}}},[e._v("重置")]),a("a",{staticStyle:{"margin-left":"8px"},on:{click:e.toggleAdvanced}},[e._v("\n              "+e._s(e.advanced?"收起":"展开")+"\n              "),a("a-icon",{attrs:{type:e.advanced?"up":"down"}})],1)],1)])],2)],1)],1),a("div",{staticClass:"table-operator"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(t){e.visible=!0}}},[e._v("新建")])],1),a("a-table",{attrs:{columns:e.columns,rowKey:function(e){return e.id},dataSource:e.data,pagination:e.pagination,loading:e.loading},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"entryUrl",fn:function(t,r){return[a("ellipsis",{attrs:{length:8,tooltip:""}},[e._v(e._s(t))])]}},{key:"listRegex",fn:function(t,r){return[a("ellipsis",{attrs:{length:8,tooltip:""}},[e._v(e._s(t))])]}},{key:"fieldsJson",fn:function(t,r){return[a("ellipsis",{attrs:{length:8,tooltip:""}},[e._v(e._s(t))])]}},{key:"action",fn:function(t,r){return[a("a-popconfirm",{attrs:{title:"任务将提交到后台运行, 确认运行?",okText:"确认",cancelText:"取消"},on:{confirm:function(t){return e.runSpider(r)}}},[a("a-icon",{staticStyle:{color:"red"},attrs:{slot:"icon",type:"question-circle-o"},slot:"icon"}),a("a-button",{staticClass:"m-r-8",attrs:{type:"primary",size:"small"}},[e._v("运行")])],1),a("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.goPage("/spider/jobList")}}},[e._v("查看任务")])]}}])}),a("a-modal",{attrs:{title:"新建蜘蛛",width:"50%",maskClosable:!1,visible:e.visible},on:{cancel:function(t){e.visible=!1}}},[a("a-spin",{attrs:{spinning:e.opLoading}},[a("a-steps",{style:{marginBottom:"28px"},attrs:{current:e.currentStep,size:"small"}},[a("a-step",{attrs:{title:"基本信息"}}),a("a-step",{attrs:{title:"配置字段规则"}})],1),a("a-form",{attrs:{form:e.form}},[a("div",{directives:[{name:"show",rawName:"v-show",value:0===e.currentStep,expression:"currentStep === 0"}]},[a("a-form-item",{attrs:{label:"蜘蛛名","label-col":{span:5},"wrapper-col":{span:12}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入蜘蛛名"}]}],expression:"['name', {rules: [{ required: true, message: '请输入蜘蛛名' }]}]"}]})],1),a("a-form-item",{attrs:{label:"表名","label-col":{span:5},"wrapper-col":{span:12}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["tableName",{rules:[{required:!0,message:"请输入表名"}]}],expression:"['tableName', {rules: [{ required: true, message: '请输入表名' }]}]"}]})],1),a("a-form-item",{attrs:{label:"入口页","label-col":{span:5},"wrapper-col":{span:12}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["entryUrl",{rules:[{required:!0,message:"请输入入口页"}]}],expression:"['entryUrl', {rules: [{ required: true, message: '请输入入口页' }]}]"}]})],1),a("a-form-item",{attrs:{label:"列表页正则","label-col":{span:5},"wrapper-col":{span:12}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["listRegex",{rules:[{required:!0,message:"请输入列表页正则"}]}],expression:"['listRegex', {rules: [{ required: true, message: '请输入列表页正则' }]}]"}]})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentStep,expression:"currentStep === 1"}]},[a("a-button",{staticClass:"m-b-8",attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增字段")]),a("a-table",{attrs:{pagination:!1,bordered:"",rowKey:function(e){return e.index},dataSource:e.dataSource,columns:e.fields},scopedSlots:e._u([{key:"key",fn:function(t,r){return[a("a-input",{attrs:{placeholder:""},on:{change:function(t){return e.handleFiledChange(r.index,"key",t)}}})]}},{key:"value",fn:function(t,r){return[a("a-input",{attrs:{placeholder:""},on:{change:function(t){return e.handleFiledChange(r.index,"value",t)}}})]}}])})],1)])],1),a("template",{slot:"footer"},[e.currentStep>0?a("a-button",{key:"back",style:{float:"left"},on:{click:e.backward}},[e._v("上一步")]):e._e(),a("a-button",{key:"cancel",on:{click:function(t){e.visible=!1}}},[e._v("取消")]),a("a-button",{key:"forward",attrs:{loading:e.opLoading,type:"primary"},on:{click:function(t){return e.handleNext(e.currentStep)}}},[e._v(e._s(1===e.currentStep?"完成":"下一步"))])],1)],2)],1)},n=[],o=(a("2338"),a("f763"),a("fb37"),a("a506"));a("608b");function s(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(e){return s(e)||i(e)||c()}a("55a0"),a("6bf2");var u=a("391c"),d=a.n(u),p=a("2af9"),f=a("b775");function m(e){return Object(f["b"])({url:"/configurable-spider/search",method:"post",data:e})}function h(e){return Object(f["b"])({url:"/configurable-spider",method:"post",data:e})}var b=a("76fe");a("b27f");function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(a,!0).forEach(function(t){Object(o["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var y={pageNo:1,pageSize:10,count:0},S=[{title:"蜘蛛名",dataIndex:"name"},{title:"表名",dataIndex:"tableName"},{title:"入口页",dataIndex:"entryUrl",scopedSlots:{customRender:"entryUrl"}},{title:"列表页正则表达式",dataIndex:"listRegex",scopedSlots:{customRender:"listRegex"}},{title:"字段规则",dataIndex:"fieldsJson",scopedSlots:{customRender:"fieldsJson"}},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],w={name:"SpiderList",components:{Ellipsis:p["c"]},data:function(){return{currentStep:0,mdl:{},advanced:!1,searchModel:d.a.cloneDeep(y),data:[],columns:S,pagination:{},loading:!1,visible:!1,opLoading:!1,form:this.$form.createForm(this),stepForms:[["name","tableName","entryUrl","listRegex"]],index:0,fields:[{title:"字段",dataIndex:"key",scopedSlots:{customRender:"key"}},{title:"XPATH规则",dataIndex:"value",scopedSlots:{customRender:"value"}}],dataSource:[]}},mounted:function(){this.search()},methods:{goPage:function(e){this.$router.push(e)},runSpider:function(e){var t=this;console.log(e),Object(b["a"])({configurableSpiderId:e.id}).then(function(e){e.success&&t.$message.success("运行成功")})},handleAdd:function(){var e=this.index,t=this.dataSource,a={index:e,key:"",value:""};this.index++,this.dataSource=[].concat(l(t),[a])},handleFiledChange:function(e,t,a){var r=l(this.dataSource),n=r.find(function(t){return t.index===e});n&&(n[t]=a.target.value,this.dataSource=r)},backward:function(){this.currentStep--},handleNext:function(e){var t=this,a=e+1;a<=1?this.form.validateFields(this.stepForms[this.currentStep],function(e,r){e||(t.currentStep=a)}):(this.opLoading=!0,this.form.validateFields(function(e,a){if(e)t.opLoading=!1;else{var r=d.a.cloneDeep(a);r.fieldsJson=JSON.stringify(t.dataSource),h(r).then(function(e){e.success&&(t.$message.success("新建成功"),t.visible=!1,t.form.resetFields(),t.dataSource=[],t.currentStep=0,t.search()),t.opLoading=!1}).catch(function(e){console.log(e),t.opLoading=!1})}}))},toggleAdvanced:function(){this.advanced=!this.advanced},handleTableChange:function(e,t,a){console.log(e);var r=v({},this.pagination);r.current=e.current,this.pagination=r,this.getList(e.current)},search:function(){this.getList(1)},getList:function(e){var t=this;this.loading=!0,void 0!=e&&(this.searchModel.pageNo=e);var a=d.a.cloneDeep(this.searchModel);m(a).then(function(e){if(e.success){t.data=e.data;var a=v({},t.pagination);a.total=e.count,t.pagination=a}t.loading=!1})}}},x=w,k=a("6691"),O=Object(k["a"])(x,r,n,!1,null,null,null);t["default"]=O.exports}}]);